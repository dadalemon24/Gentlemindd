<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gentle Mind - ‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏û‡∏±‡∏Å‡πÉ‡∏à</title>
    <link href="https://fonts.googleapis.com/css2?family=Kodchasan:wght@300;400;600&family=Sarabun:wght@300;400&display=swap" rel="stylesheet">
    <style>
        :root {
            /* Cute Pastel Palette */
            --bg-gradient: linear-gradient(120deg, #fccb90 0%, #d57eeb 100%); /* Sunset Pastel */
            --bg-body: linear-gradient(to top, #fad0c4 0%, #ffd1ff 100%); /* Pinky Cloud */
            
            --card-bg: rgba(255, 255, 255, 0.95);
            --text-main: #6c5ce7;
            --text-light: #a29bfe;
            
            /* Main Colors */
            --primary: #FF9A9E; /* Sweet Pink */
            --primary-hover: #ff7675;
            --secondary: #74b9ff; /* Soft Blue */
            
            /* Mood Colors (Pastel Candy) */
            --m-amazing: #ffeaa7;  /* Creamy Yellow */
            --m-happy: #55efc4;    /* Mint */
            --m-normal: #fab1a0;   /* Peach */
            --m-exhausted: #dfe6e9; /* Cloud Grey */
            --m-sad: #74b9ff;      /* Baby Blue */
            --m-angry: #ff7675;    /* Soft Red */
        }

        body {
            font-family: 'Sarabun', sans-serif;
            background-image: var(--bg-body);
            background-attachment: fixed;
            color: var(--text-main);
            margin: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            /* Fixes potential horizontal scroll on mobile body */
            overflow-x: hidden; 
        }

        /* Desktop Container - Cute Style */
        .app-container {
            width: 850px; /* Desktop width */
            height: 650px; /* Desktop height */
            max-width: 95vw; /* Max width for mobile */
            min-height: 100vh; /* Allow it to use full height on mobile */
            background: var(--card-bg);
            border-radius: 50px; 
            box-shadow: 0 20px 50px rgba(255, 107, 107, 0.15);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            position: relative;
            border: 4px solid #fff;
        }

        /* Header */
        header {
            padding: 20px 40px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: rgba(255,255,255,0.5);
            backdrop-filter: blur(5px);
        }

        .brand {
            font-family: 'Kodchasan', sans-serif;
            font-size: 1.8rem;
            color: var(--primary);
            font-weight: 600;
            letter-spacing: 1px;
            display: flex;
            align-items: center;
            gap: 10px;
            text-shadow: 2px 2px 0px rgba(0,0,0,0.05);
        }

        .controls {
            display: flex;
            gap: 15px;
        }

        .icon-btn {
            background: #fff;
            border: 2px solid #f1f2f6;
            padding: 8px 18px;
            border-radius: 30px;
            cursor: pointer;
            font-family: 'Sarabun', sans-serif;
            transition: all 0.3s cubic-bezier(0.68, -0.55, 0.27, 1.55); 
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 0.9rem;
            color: #b2bec3;
            white-space: nowrap; /* Prevent button text from wrapping */
        }
        .icon-btn:hover { transform: translateY(-3px); border-color: var(--primary); color: var(--primary); }
        .icon-btn.active { background: var(--primary); color: white; border-color: var(--primary); box-shadow: 0 5px 15px rgba(255, 154, 158, 0.4); }

        /* Screens */
        .screen {
            flex: 1;
            padding: 30px 50px;
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            animation: floatUp 0.6s ease;
        }
        .screen.active { display: flex; }

        @keyframes floatUp {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        h1 { font-family: 'Kodchasan'; font-weight: 600; margin-bottom: 5px; color: #2d3436; font-size: 2.2rem; }
        p { color: #888; margin-bottom: 30px; font-size: 1.1rem; }

        /* Mood Grid - Cute Cards */
        .mood-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr); /* Default 3 columns */
            gap: 20px;
            width: 100%;
            max-width: 650px;
        }

        .mood-card {
            border: none;
            padding: 25px;
            border-radius: 35px; 
            font-family: 'Kodchasan';
            font-size: 1.1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            color: #555;
            background: white;
            box-shadow: 0 5px 15px rgba(0,0,0,0.03);
        }
        .mood-card:hover { transform: translateY(-8px) scale(1.02); box-shadow: 0 15px 30px rgba(0,0,0,0.08); }

        /* Setup Section */
        .wisdom-box {
            background: #FFF0F5; /* Lavender Blush */
            border: 2px dashed var(--primary);
            padding: 30px;
            border-radius: 30px;
            font-style: italic;
            font-size: 1.2rem;
            max-width: 600px;
            margin-bottom: 30px;
            line-height: 1.6;
            color: #636e72;
            position: relative;
        }
        .wisdom-box::before { content: '‚ú®'; position: absolute; top: -15px; left: 20px; font-size: 2rem; background: var(--card-bg); padding: 0 10px; }

        .time-selector {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .time-btn {
            padding: 10px 25px;
            border: 2px solid #eee;
            background: white;
            border-radius: 30px;
            cursor: pointer;
            font-size: 1rem;
            transition: 0.3s;
            color: #888;
            font-weight: 600;
            white-space: nowrap; /* Prevent button text from wrapping */
        }
        .time-btn:hover { border-color: var(--secondary); color: var(--secondary); background: #f0f8ff; transform: scale(1.05); }

        .custom-time {
            margin-top: 25px;
            display: flex;
            align-items: center;
            gap: 10px;
            background: #f9f9f9;
            padding: 10px 20px;
            border-radius: 40px;
        }
        input[type="number"] {
            width: 60px; padding: 8px; border-radius: 15px; border: 1px solid #ddd; text-align: center; outline: none;
        }
        input[type="number"]:focus { border-color: var(--primary); }

        /* Meditation Circle - Beautiful Gradient */
        .circle-container {
            position: relative;
            width: 300px;
            height: 300px;
            display: flex;
            justify-content: center;
            align-items: center;
            margin-bottom: 20px;
        }

        .circle {
            width: 220px;
            height: 220px;
            /* Gradient for breathing circle */
            background: linear-gradient(to top, #a18cd1 0%, #fbc2eb 100%);
            border-radius: 50%;
            opacity: 0.8;
            box-shadow: 0 0 50px rgba(251, 194, 235, 0.6);
            transform: scale(0.8);
        }

        .breathing {
            animation: breatheAnimation 8s infinite ease-in-out;
        }

        @keyframes breatheAnimation {
            0% { transform: scale(0.8); opacity: 0.7; } 
            45% { transform: scale(1.3); opacity: 1; filter: hue-rotate(20deg); }  
            55% { transform: scale(1.3); opacity: 1; filter: hue-rotate(20deg); }  
            100% { transform: scale(0.8); opacity: 0.7; }
        }

        .timer-text {
            font-size: 4rem;
            font-family: 'Kodchasan';
            color: white;
            text-shadow: 0 2px 10px rgba(0,0,0,0.1);
            position: absolute;
            z-index: 10;
        }

        .guide-text {
            font-size: 1.8rem;
            color: var(--primary);
            height: 40px;
            margin-bottom: 10px;
            font-weight: 600;
            font-family: 'Kodchasan';
        }

        /* Cute Buttons */
        .btn-primary {
            background: var(--primary); 
            color: white; border: none; padding: 15px 50px;
            border-radius: 50px; font-size: 1.2rem; cursor: pointer; margin-top: 20px;
            box-shadow: 0 10px 20px rgba(255, 154, 158, 0.4);
            transition: 0.3s;
            font-family: 'Kodchasan';
        }
        .btn-primary:hover { transform: translateY(-3px); background: var(--primary-hover); box-shadow: 0 15px 25px rgba(255, 154, 158, 0.5); }
        
        .btn-text {
            background: none; border: none; color: #b2bec3; 
            cursor: pointer; margin-top: 20px; font-size: 0.95rem;
            transition: 0.2s;
        }
        .btn-text:hover { color: var(--primary); text-decoration: underline; }

        /* Stats List */
        .history-container {
            width: 100%; max-width: 600px; max-height: 280px; overflow-y: auto;
            text-align: left; background: #fff; padding: 20px; border-radius: 25px;
            border: 2px solid #f0f0f0;
        }
        .history-item {
            display: flex; justify-content: space-between; border-bottom: 1px dashed #eee;
            padding: 12px 0; font-size: 1rem; align-items: center;
        }
        
        /* Custom Scrollbar for cute look */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; border-radius: 10px; }
        ::-webkit-scrollbar-thumb { background: #ffd1dc; border-radius: 10px; }
        ::-webkit-scrollbar-thumb:hover { background: #ffb7b2; }

        /* --- MOBILE RESPONSIVENESS (Media Query) --- */
        @media (max-width: 890px) {
            /* General App Container Adjustments */
            .app-container {
                width: 100%; /* Use full width */
                height: auto; /* Allow height to adjust dynamically */
                border-radius: 0; /* Remove extreme corner radius on full mobile screen */
                box-shadow: none; /* Remove shadow when full screen */
                border: none;
            }

            /* Header Adjustments */
            header {
                padding: 15px 20px;
                flex-direction: column; /* Stack header items */
                gap: 10px;
                text-align: center;
            }
            .controls {
                justify-content: center;
                flex-wrap: wrap;
            }
            .icon-btn {
                padding: 8px 15px;
                font-size: 0.85rem;
            }

            /* Screen Padding */
            .screen {
                padding: 20px;
            }

            h1 {
                font-size: 1.8rem;
            }
            p {
                font-size: 1rem;
                margin-bottom: 20px;
            }

            /* MOOD GRID - Change to 2 columns on mobile */
            .mood-grid {
                grid-template-columns: repeat(2, 1fr); 
                gap: 15px;
                max-width: 100%;
            }
            .mood-card {
                padding: 15px;
                font-size: 1rem;
                border-radius: 25px;
            }
            .mood-card span {
                font-size: 1.5rem !important; /* Adjust icon size */
            }

            /* Setup Screen Adjustments */
            .wisdom-box {
                padding: 20px;
                font-size: 1rem;
                margin-bottom: 20px;
                border-radius: 20px;
            }

            .time-selector {
                gap: 8px;
            }
            .time-btn {
                padding: 8px 15px;
                font-size: 0.9rem;
            }
            
            .custom-time {
                flex-wrap: wrap;
                justify-content: center;
            }
            
            /* Timer Screen Adjustments */
            .circle-container {
                width: 250px;
                height: 250px;
            }
            .circle {
                width: 180px;
                height: 180px;
            }
            .timer-text {
                font-size: 3rem;
            }
            .guide-text {
                font-size: 1.4rem;
            }

            /* Stats Adjustments */
            .history-container {
                padding: 15px;
            }
        }

    </style>
</head>
<body>

<div class="app-container">
    <header>
        <div class="brand">
            <span style="font-size: 1.5rem;">‚ù§Ô∏è</span> 
            <span>Gentle Mind</span>
        </div>
        <div class="controls">
            <button class="icon-btn active" id="audio-btn" onclick="toggleAudio()">
                <span>üîä ‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏ô‡∏≥‡∏ù‡∏∂‡∏Å</span>
            </button>
            <button class="icon-btn" onclick="showHistory()">
                <span>üìä ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥</span>
            </button>
        </div>
    </header>

    <div id="screen-mood" class="screen active">
        <h1>‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏¢‡∏±‡∏á‡πÑ‡∏á‡∏ö‡πâ‡∏≤‡∏á?</h1>
        <p>‡∏•‡∏≠‡∏á‡∏™‡∏≥‡∏£‡∏ß‡∏à‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ‡∏™‡∏∂‡∏Å‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á ‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏µ‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡∏∏‡∏ì‡πÉ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ</p>
        
        <div class="mood-grid">
            <button class="mood-card" style="background:var(--m-amazing)" onclick="selectMood('Amazing', 'yellow')">
                <span style="font-size:2rem;">üòÅ</span> Amazing
            </button>
            <button class="mood-card" style="background:var(--m-happy)" onclick="selectMood('Happy', 'green')">
                <span style="font-size:2rem;">üòä</span> Happy
            </button>
            <button class="mood-card" style="background:var(--m-normal)" onclick="selectMood('Normal', 'orange')">
                <span style="font-size:2rem;">üòê</span> Normal
            </button>
            <button class="mood-card" style="background:var(--m-exhausted)" onclick="selectMood('Exhausted', 'gray')">
                <span style="font-size:2rem;">üò©</span> Exhausted
            </button>
            <button class="mood-card" style="background:var(--m-sad)" onclick="selectMood('Sad', 'blue')">
                <span style="font-size:2rem;">üò¢</span> Sad/Blue
            </button>
            <button class="mood-card" style="background:var(--m-angry)" onclick="selectMood('Angry', 'red')">
                <span style="font-size:2rem;">üò°</span> Angry
            </button>
        </div>
    </div>

    <div id="screen-setup" class="screen">
        <h2 id="greeting" style="color:var(--primary);">‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤‡∏Ñ‡πà‡∏∞</h2>
        <div class="wisdom-box" id="wisdom-text">...</div>

        <p>‡πÉ‡∏´‡πâ‡πÄ‡∏ß‡∏•‡∏≤‡∏Ç‡∏≠‡∏á‡∏Ç‡∏ß‡∏±‡∏ç‡∏Å‡∏±‡∏ö‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á‡∏™‡∏±‡∏Å‡∏´‡∏ô‡πà‡∏≠‡∏¢‡∏ô‡∏∞‡∏Ñ‡∏∞</p>
        <div class="time-selector">
            <button class="time-btn" onclick="startSession(1)">1 ‡∏ô‡∏≤‡∏ó‡∏µ</button>
            <button class="time-btn" onclick="startSession(5)">5 ‡∏ô‡∏≤‡∏ó‡∏µ</button>
            <button class="time-btn" onclick="startSession(15)">15 ‡∏ô‡∏≤‡∏ó‡∏µ</button>
            <button class="time-btn" onclick="startSession(30)">30 ‡∏ô‡∏≤‡∏ó‡∏µ</button>
            <button class="time-btn" onclick="startSession(60)">1 ‡∏ä‡∏°.</button>
        </div>
        <div class="custom-time">
            <span>‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÄ‡∏≠‡∏á:</span>
            <input type="number" id="c-min" placeholder="‡∏ô‡∏≤‡∏ó‡∏µ">
            <input type="number" id="c-sec" placeholder="‡∏ß‡∏¥">
            <button class="time-btn" style="border:none; background:var(--primary); color:white;" onclick="startCustom()">‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏•‡∏¢</button>
        </div>
        <button class="btn-text" onclick="goScreen('screen-mood')">‚¨Ö ‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö</button>
    </div>

    <div id="screen-timer" class="screen">
        <div class="guide-text" id="breath-guide">...</div>
        
        <div class="circle-container">
            <div class="circle" id="breath-circle"></div>
            <div class="timer-text" id="timer-display">00:00</div>
        </div>

        <p>‡∏ú‡πà‡∏≠‡∏ô‡∏Ñ‡∏•‡∏≤‡∏¢... ‡∏≠‡∏¢‡∏π‡πà‡∏Å‡∏±‡∏ö‡∏•‡∏°‡∏´‡∏≤‡∏¢‡πÉ‡∏à‡∏ï‡∏≤‡∏°‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏∞‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏ô‡∏∞‡∏Ñ‡∏∞</p>
        <button class="btn-text" onclick="stopSession()">‡∏´‡∏¢‡∏∏‡∏î‡∏û‡∏±‡∏Å / ‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î</button>
    </div>

    <div id="screen-summary" class="screen">
        <h1 style="color:var(--secondary);">‡πÄ‡∏Å‡πà‡∏á‡∏°‡∏≤‡∏Å‡πÄ‡∏•‡∏¢‡∏Ñ‡πà‡∏∞! ‚ú®</h1>
        <p>‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏µ‡πà‡∏£‡∏±‡∏Å‡πÅ‡∏•‡∏∞‡∏î‡∏π‡πÅ‡∏•‡πÉ‡∏à‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á‡πÉ‡∏ô‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡∏ô‡∏∞‡∏Ñ‡∏∞</p>
        
        <div class="history-container" id="history-list"></div>

        <button class="btn-primary" onclick="goScreen('screen-mood')">‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</button>
    </div>
</div>

<script>
    // --- Data & Variables ---
    let isAudioOn = true;
    let selectedMood = '';
    let timerInterval;
    let breathInterval;
    let totalSeconds = 0;
    let initialSeconds = 0;

    // ‡∏Ñ‡∏≥‡∏û‡∏π‡∏î‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô
    const quotes = [
        "‡∏à‡∏á‡∏≠‡πà‡∏≠‡∏ô‡πÇ‡∏¢‡∏ô‡∏Å‡∏±‡∏ö‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á ‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡πÉ‡∏à‡∏î‡∏µ‡∏Å‡∏±‡∏ö‡∏ú‡∏π‡πâ‡∏≠‡∏∑‡πà‡∏ô",
        "‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ‡∏™‡∏∂‡∏Å‡∏°‡∏≤‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ ‡πÅ‡∏•‡πâ‡∏ß‡∏Å‡πá‡∏à‡∏∞‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏õ",
        "‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏∏‡∏Ç‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏á‡∏ö‡πÉ‡∏ô‡πÉ‡∏à‡πÄ‡∏£‡∏≤",
        "‡∏Å‡∏≤‡∏£‡∏û‡∏±‡∏Å‡∏ú‡πà‡∏≠‡∏ô‡∏Ñ‡∏∑‡∏≠‡∏™‡πà‡∏ß‡∏ô‡∏´‡∏ô‡∏∂‡πà‡∏á‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à",
        "‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏≥‡∏î‡∏µ‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î‡πÅ‡∏•‡πâ‡∏ß ‡∏¢‡∏¥‡πâ‡∏°‡πÉ‡∏´‡πâ‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á‡∏´‡∏ô‡πà‡∏≠‡∏¢‡∏ô‡∏∞",
        "‡πÇ‡∏≠‡∏ö‡∏Å‡∏≠‡∏î‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ‡∏™‡∏∂‡∏Å ‡∏î‡πâ‡∏ß‡∏¢‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à"
    ];

    // --- Navigation ---
    function goScreen(id) {
        document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        
        // Stop audio if leaving timer
        if(id !== 'screen-timer') {
            window.speechSynthesis.cancel();
            clearInterval(timerInterval);
            clearInterval(breathInterval);
            document.getElementById('breath-circle').classList.remove('breathing');
        }
    }

    // --- Audio Control ---
    function toggleAudio() {
        isAudioOn = !isAudioOn;
        const btn = document.getElementById('audio-btn');
        if(isAudioOn) {
            btn.classList.add('active');
            btn.innerHTML = '<span>üîä ‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏ô‡∏≥‡∏ù‡∏∂‡∏Å</span>';
        } else {
            btn.classList.remove('active');
            btn.innerHTML = '<span>üîá ‡∏õ‡∏¥‡∏î‡πÄ‡∏™‡∏µ‡∏¢‡∏á</span>';
            window.speechSynthesis.cancel();
        }
    }

    function speak(text) {
        if(!isAudioOn) return;
        window.speechSynthesis.cancel();
        const utterance = new SpeechSynthesisUtterance(text);
        utterance.lang = 'th-TH'; // ‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢
        utterance.rate = 0.8; 
        utterance.volume = 0.9;
        window.speechSynthesis.speak(utterance);
    }

    // --- Logic ---
    function selectMood(mood, colorName) {
        selectedMood = mood;
        const randomQuote = quotes[Math.floor(Math.random() * quotes.length)];
        
        document.getElementById('wisdom-text').innerText = `"${randomQuote}"`;
        document.getElementById('greeting').innerText = `‡∏£‡∏±‡∏ö‡∏£‡∏π‡πâ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ‡∏™‡∏∂‡∏Å: ${mood} ‡∏Ñ‡πà‡∏∞`;
        
        goScreen('screen-setup');
    }

    function startSession(minutes) {
        runTimer(minutes * 60);
    }

    function startCustom() {
        const m = parseInt(document.getElementById('c-min').value) || 0;
        const s = parseInt(document.getElementById('c-sec').value) || 0;
        const t = (m * 60) + s;
        if(t > 0) runTimer(t);
    }

    function runTimer(seconds) {
        totalSeconds = seconds;
        initialSeconds = seconds;
        updateDisplay();
        goScreen('screen-timer');

        // Animation & Voice Logic
        const circle = document.getElementById('breath-circle');
        const guide = document.getElementById('breath-guide');
        
        circle.classList.add('breathing');
        
        const breathLoop = () => {
            if(totalSeconds <= 0) return;
            
            // Inhale (4s)
            guide.innerText = "‡∏´‡∏≤‡∏¢‡πÉ‡∏à‡πÄ‡∏Ç‡πâ‡∏≤...";
            speak("‡∏´‡∏≤‡∏¢‡πÉ‡∏à‡πÄ‡∏Ç‡πâ‡∏≤");

            // Exhale (after 4s)
            setTimeout(() => {
                if(totalSeconds > 0) {
                    guide.innerText = "‡∏´‡∏≤‡∏¢‡πÉ‡∏à‡∏≠‡∏≠‡∏Å...";
                    speak("‡∏´‡∏≤‡∏¢‡πÉ‡∏à‡∏≠‡∏≠‡∏Å");
                }
            }, 4000); 
        };

        breathLoop();
        breathInterval = setInterval(breathLoop, 8000); 

        timerInterval = setInterval(() => {
            totalSeconds--;
            updateDisplay();
            if(totalSeconds <= 0) {
                finishSession();
            }
        }, 1000);
    }

    function updateDisplay() {
        const m = Math.floor(totalSeconds / 60).toString().padStart(2, '0');
        const s = (totalSeconds % 60).toString().padStart(2, '0');
        document.getElementById('timer-display').innerText = `${m}:${s}`;
    }

    function stopSession() {
        if(confirm("‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏à‡∏ö‡∏Å‡∏≤‡∏£‡∏ù‡∏∂‡∏Å‡πÅ‡∏•‡∏∞‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡πÄ‡∏•‡∏¢‡πÑ‡∏´‡∏°‡∏Ñ‡∏∞?")) {
            finishSession();
        } else {
            goScreen('screen-mood');
        }
    }

    function finishSession() {
        clearInterval(timerInterval);
        clearInterval(breathInterval);
        window.speechSynthesis.cancel();
        
        saveStats(initialSeconds - totalSeconds);
        showHistory(true); // Call showHistory to display the summary
        goScreen('screen-summary');
    }

    // --- Stats ---
    function saveStats(duration) {
        if(duration < 5) return; 
        const stats = JSON.parse(localStorage.getItem('gentleMindV3')) || [];
        const now = new Date();
        stats.unshift({
            date: now.toLocaleDateString('th-TH'),
            time: now.toLocaleTimeString('th-TH', {hour: '2-digit', minute:'2-digit'}),
            mood: selectedMood,
            duration: duration
        });
        localStorage.setItem('gentleMindV3', JSON.stringify(stats));
    }

    function showHistory(isSummaryScreen = false) {
        const stats = JSON.parse(localStorage.getItem('gentleMindV3')) || [];
        const container = document.getElementById('history-list');
        container.innerHTML = '';
        
        if(stats.length === 0) {
            container.innerHTML = '<p style="text-align:center; color:#ccc;">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏™‡∏∞‡∏™‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏∏‡∏Ç‡∏Å‡∏±‡∏ô‡πÄ‡∏ñ‡∏≠‡∏∞</p>';
            if(!isSummaryScreen) { // If user clicked "üìä ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥" button, move to summary screen
                goScreen('screen-summary');
                document.querySelector('#screen-summary h1').innerText = "‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì";
            }
            return;
        }

        stats.forEach(s => {
            const div = document.createElement('div');
            div.className = 'history-item';
            
            const mins = Math.floor(s.duration / 60);
            const secs = s.duration % 60;
            const timeStr = mins > 0 ? `${mins} ‡∏ô‡∏≤‡∏ó‡∏µ ${secs} ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ` : `${secs} ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ`;

            // Emoji mapping
            let moodIcon = "üòê";
            if(s.mood === 'Amazing') moodIcon = "üòÅ";
            else if(s.mood === 'Happy') moodIcon = "üòä";
            else if(s.mood === 'Exhausted') moodIcon = "üò©";
            else if(s.mood === 'Sad') moodIcon = "üò¢";
            else if(s.mood === 'Angry') moodIcon = "üò°";

            div.innerHTML = `
                <div>
                    <span style="font-size:1.2rem; margin-right:5px;">${moodIcon}</span>
                    <strong style="color:#555;">${s.mood}</strong> 
                    <span style="color:#aaa; font-size:0.85rem; margin-left:5px;">(${s.date})</span>
                </div>
                <div style="color:var(--primary); font-weight:600;">${timeStr}</div>
            `;
            container.appendChild(div);
        });

        if(!isSummaryScreen) { // If user clicked "üìä ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥" button, move to summary screen
            goScreen('screen-summary');
            document.querySelector('#screen-summary h1').innerText = "‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì";
        }
    }
</script>

</body>
</html>
